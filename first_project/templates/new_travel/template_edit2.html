{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">

    <h2 class="mb-3">
        {{ template.travel_info.travel_title }}
        <span class="text-muted fs-6">（テンプレート編集）</span>
    </h2>

    <form method="POST">
        {% csrf_token %}

        {% for category in categories %}
            <div class="card mb-3 shadow-sm">

                <!-- カテゴリヘッダー（old_template と同じ構造） -->
                <div class="card-header text-white d-flex justify-content-between align-items-center"
                     style="background-color: {{ category.get_category_color_display }};">
                    <strong>{{ category.category_name }}</strong>

                    <button type="submit"
                            name="delete_category"
                            value="{{ category.id }}"
                            class="btn btn-sm btn-outline-light">
                        ×
                    </button>
                </div>

                <ul class="list-group list-group-flush">

                    {% for item in category.travelitem_set.all %}
                        <li class="list-group-item">

                            <div class="d-flex align-items-center w-100">

                                <!-- チェック（編集可能） -->
                                <input type="checkbox"
                                       name="item_checked_{{ item.id }}"
                                       class="form-check-input me-2"
                                       {% if item.item_checked %}checked{% endif %}>

                                <!-- 名前変更（old_template の幅に合わせて調整） -->
                                <input type="text"
                                       name="rename_{{ item.id }}"
                                       value="{{ item.item_name }}"
                                       class="form-control me-2">

                                <!-- 削除ボタン -->
                                <button type="submit"
                                        name="delete_item"
                                        value="{{ item.id }}"
                                        class="btn btn-sm btn-outline-danger">
                                    ×
                                </button>

                            </div>

                        </li>
                    {% endfor %}

                </ul>

            </div>
        {% endfor %}

        <button type="submit" class="btn btn-primary w-100 mt-3">保存</button>
    </form>

</div>
{% endblock %}