{% extends "base.html" %}
{% load static %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'tabipre/css/template_base.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-0">

    <!-- タイトル -->
    {% include "old_travel/travel_card.html" %}

    <!-- メモ -->
    {% if travel_info.memo %}
        <div class="mb-3">
            <div id="memoArea" class="collapse show">
                <div class="card card-body">
                    {{ travel_info.memo|linebreaksbr }}
                </div>
            </div>
            <button class="memo-toggle-btn"
                    data-bs-toggle="collapse"
                    data-bs-target="#memoArea">
                メモを非表示
            </button>
        </div>
    {% endif %}

    <!-- 分類と項目 -->
    {% for category in categories %}
        <div class="card mb-3 shadow-sm">

            <div class="card-header text-white d-flex justify-content-between align-items-center"
                 style="background-color: {{ category.get_category_color_display }};">

                <div class="d-flex align-items-center">
                    <strong>{{ category.category_name }}</strong>

                    <span class="badge bg-light text-dark ms-2">
                        {{ category.checked_count }} / {{ category.total_count }}
                    </span>
                </div>
            </div>

            <ul id="cat{{ category.id }}" class="list-group list-group-flush">

                {# ★ 修正ポイント：category を渡す ★ #}
                {% include "parts/category_card_editable.html" with category=category %}

            </ul>

        </div>
    {% endfor %}

    <!-- すべてのチェックを外す -->
    <div class="mt-3">
        <a href="{% url 'app:travel_uncheck_all' travel_info.travel_info_id %}" class="uncheck-link">
            すべてのチェックを外す
        </a>
    </div>

    <!-- 編集ボタン & 共有リンク -->
    <div class="mt-3 d-flex gap-2 edit-button">

        {% if template %}
            <a href="{% url 'app:old_template_edit' template.id %}" class="btn btn-primary">
                編集する
            </a>
        {% else %}
            <span class="text-muted align-self-center">テンプレートは作成されていません</span>
        {% endif %}

        <a href="{% url 'app:travel_link' travel_info.travel_info_id %}" class="btn btn-link">
            共有リンクへ
        </a>

    </div>

</div>

<script src="{% static 'tabipre/js/old_travel/travel_detail.js' %}"></script>

{% endblock %}